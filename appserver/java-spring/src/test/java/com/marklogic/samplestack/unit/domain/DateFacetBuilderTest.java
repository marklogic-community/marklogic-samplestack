package com.marklogic.samplestack.unit.domain;

import org.joda.time.DateTime;
import org.json.JSONException;
import org.junit.Test;
import org.junit.experimental.categories.Category;
import org.skyscreamer.jsonassert.JSONAssert;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.marklogic.samplestack.domain.DateFacetBuilder;
import com.marklogic.samplestack.impl.CustomObjectMapper;
import com.marklogic.samplestack.testing.UnitTests;

@Category(UnitTests.class)
public class DateFacetBuilderTest {
	
	
	
	@Test
	public void testDayBuilder() throws JsonProcessingException, JSONException {
		ObjectMapper mapper = new CustomObjectMapper();
		DateTime minDate = new DateTime(2013, 1, 31, 0, 0);
		DateTime maxDate =minDate.plusDays(30);
		
		String actual = mapper.writeValueAsString(
				DateFacetBuilder.dateFacet(minDate, maxDate));

		String expected = "{\"constraint\":{\"range\":{\"type\":\"xs:dateTime\",\"facet\":true,\"json-property\":\"lastActivityDate\",\"bucket\":[{\"ge\":\"2013-01-31T00:00:00.000-08:00\",\"lt\":\"2013-02-01T00:00:00.000-08:00\",\"name\":\"2013-01-31T00:00:00.000-08:00\",\"label\":\"2013-01-31\"},{\"ge\":\"2013-02-01T00:00:00.000-08:00\",\"lt\":\"2013-02-02T00:00:00.000-08:00\",\"name\":\"2013-02-01T00:00:00.000-08:00\",\"label\":\"2013-02-01\"},{\"ge\":\"2013-02-02T00:00:00.000-08:00\",\"lt\":\"2013-02-03T00:00:00.000-08:00\",\"name\":\"2013-02-02T00:00:00.000-08:00\",\"label\":\"2013-02-02\"},{\"ge\":\"2013-02-03T00:00:00.000-08:00\",\"lt\":\"2013-02-04T00:00:00.000-08:00\",\"name\":\"2013-02-03T00:00:00.000-08:00\",\"label\":\"2013-02-03\"},{\"ge\":\"2013-02-04T00:00:00.000-08:00\",\"lt\":\"2013-02-05T00:00:00.000-08:00\",\"name\":\"2013-02-04T00:00:00.000-08:00\",\"label\":\"2013-02-04\"},{\"ge\":\"2013-02-05T00:00:00.000-08:00\",\"lt\":\"2013-02-06T00:00:00.000-08:00\",\"name\":\"2013-02-05T00:00:00.000-08:00\",\"label\":\"2013-02-05\"},{\"ge\":\"2013-02-06T00:00:00.000-08:00\",\"lt\":\"2013-02-07T00:00:00.000-08:00\",\"name\":\"2013-02-06T00:00:00.000-08:00\",\"label\":\"2013-02-06\"},{\"ge\":\"2013-02-07T00:00:00.000-08:00\",\"lt\":\"2013-02-08T00:00:00.000-08:00\",\"name\":\"2013-02-07T00:00:00.000-08:00\",\"label\":\"2013-02-07\"},{\"ge\":\"2013-02-08T00:00:00.000-08:00\",\"lt\":\"2013-02-09T00:00:00.000-08:00\",\"name\":\"2013-02-08T00:00:00.000-08:00\",\"label\":\"2013-02-08\"},{\"ge\":\"2013-02-09T00:00:00.000-08:00\",\"lt\":\"2013-02-10T00:00:00.000-08:00\",\"name\":\"2013-02-09T00:00:00.000-08:00\",\"label\":\"2013-02-09\"},{\"ge\":\"2013-02-10T00:00:00.000-08:00\",\"lt\":\"2013-02-11T00:00:00.000-08:00\",\"name\":\"2013-02-10T00:00:00.000-08:00\",\"label\":\"2013-02-10\"},{\"ge\":\"2013-02-11T00:00:00.000-08:00\",\"lt\":\"2013-02-12T00:00:00.000-08:00\",\"name\":\"2013-02-11T00:00:00.000-08:00\",\"label\":\"2013-02-11\"},{\"ge\":\"2013-02-12T00:00:00.000-08:00\",\"lt\":\"2013-02-13T00:00:00.000-08:00\",\"name\":\"2013-02-12T00:00:00.000-08:00\",\"label\":\"2013-02-12\"},{\"ge\":\"2013-02-13T00:00:00.000-08:00\",\"lt\":\"2013-02-14T00:00:00.000-08:00\",\"name\":\"2013-02-13T00:00:00.000-08:00\",\"label\":\"2013-02-13\"},{\"ge\":\"2013-02-14T00:00:00.000-08:00\",\"lt\":\"2013-02-15T00:00:00.000-08:00\",\"name\":\"2013-02-14T00:00:00.000-08:00\",\"label\":\"2013-02-14\"},{\"ge\":\"2013-02-15T00:00:00.000-08:00\",\"lt\":\"2013-02-16T00:00:00.000-08:00\",\"name\":\"2013-02-15T00:00:00.000-08:00\",\"label\":\"2013-02-15\"},{\"ge\":\"2013-02-16T00:00:00.000-08:00\",\"lt\":\"2013-02-17T00:00:00.000-08:00\",\"name\":\"2013-02-16T00:00:00.000-08:00\",\"label\":\"2013-02-16\"},{\"ge\":\"2013-02-17T00:00:00.000-08:00\",\"lt\":\"2013-02-18T00:00:00.000-08:00\",\"name\":\"2013-02-17T00:00:00.000-08:00\",\"label\":\"2013-02-17\"},{\"ge\":\"2013-02-18T00:00:00.000-08:00\",\"lt\":\"2013-02-19T00:00:00.000-08:00\",\"name\":\"2013-02-18T00:00:00.000-08:00\",\"label\":\"2013-02-18\"},{\"ge\":\"2013-02-19T00:00:00.000-08:00\",\"lt\":\"2013-02-20T00:00:00.000-08:00\",\"name\":\"2013-02-19T00:00:00.000-08:00\",\"label\":\"2013-02-19\"},{\"ge\":\"2013-02-20T00:00:00.000-08:00\",\"lt\":\"2013-02-21T00:00:00.000-08:00\",\"name\":\"2013-02-20T00:00:00.000-08:00\",\"label\":\"2013-02-20\"},{\"ge\":\"2013-02-21T00:00:00.000-08:00\",\"lt\":\"2013-02-22T00:00:00.000-08:00\",\"name\":\"2013-02-21T00:00:00.000-08:00\",\"label\":\"2013-02-21\"},{\"ge\":\"2013-02-22T00:00:00.000-08:00\",\"lt\":\"2013-02-23T00:00:00.000-08:00\",\"name\":\"2013-02-22T00:00:00.000-08:00\",\"label\":\"2013-02-22\"},{\"ge\":\"2013-02-23T00:00:00.000-08:00\",\"lt\":\"2013-02-24T00:00:00.000-08:00\",\"name\":\"2013-02-23T00:00:00.000-08:00\",\"label\":\"2013-02-23\"},{\"ge\":\"2013-02-24T00:00:00.000-08:00\",\"lt\":\"2013-02-25T00:00:00.000-08:00\",\"name\":\"2013-02-24T00:00:00.000-08:00\",\"label\":\"2013-02-24\"},{\"ge\":\"2013-02-25T00:00:00.000-08:00\",\"lt\":\"2013-02-26T00:00:00.000-08:00\",\"name\":\"2013-02-25T00:00:00.000-08:00\",\"label\":\"2013-02-25\"},{\"ge\":\"2013-02-26T00:00:00.000-08:00\",\"lt\":\"2013-02-27T00:00:00.000-08:00\",\"name\":\"2013-02-26T00:00:00.000-08:00\",\"label\":\"2013-02-26\"},{\"ge\":\"2013-02-27T00:00:00.000-08:00\",\"lt\":\"2013-02-28T00:00:00.000-08:00\",\"name\":\"2013-02-27T00:00:00.000-08:00\",\"label\":\"2013-02-27\"},{\"ge\":\"2013-02-28T00:00:00.000-08:00\",\"lt\":\"2013-03-01T00:00:00.000-08:00\",\"name\":\"2013-02-28T00:00:00.000-08:00\",\"label\":\"2013-02-28\"},{\"ge\":\"2013-03-01T00:00:00.000-08:00\",\"lt\":\"2013-03-02T00:00:00.000-08:00\",\"name\":\"2013-03-01T00:00:00.000-08:00\",\"label\":\"2013-03-01\"}]},\"name\":\"date\"}}";
	
		JSONAssert.assertEquals(actual, expected, false);	
	}
	
	@Test
	public void testWeekBuilder() throws JsonProcessingException, JSONException {
		ObjectMapper mapper = new CustomObjectMapper();
		DateTime minDate = new DateTime(2013, 1, 31, 0, 0);
		DateTime maxDate =minDate.plusDays(120);
		
		String actual = mapper.writeValueAsString(
				DateFacetBuilder.dateFacet(minDate, maxDate));
		
		String expected = "{\"constraint\":{\"range\":{\"type\":\"xs:dateTime\",\"facet\":true,\"json-property\":\"lastActivityDate\",\"bucket\":[{\"ge\":\"2013-01-27T00:00:00.000-08:00\",\"lt\":\"2013-02-03T00:00:00.000-08:00\",\"name\":\"2013-01-27T00:00:00.000-08:00\",\"label\":\"2013-04\"},{\"ge\":\"2013-02-03T00:00:00.000-08:00\",\"lt\":\"2013-02-10T00:00:00.000-08:00\",\"name\":\"2013-02-03T00:00:00.000-08:00\",\"label\":\"2013-05\"},{\"ge\":\"2013-02-10T00:00:00.000-08:00\",\"lt\":\"2013-02-17T00:00:00.000-08:00\",\"name\":\"2013-02-10T00:00:00.000-08:00\",\"label\":\"2013-06\"},{\"ge\":\"2013-02-17T00:00:00.000-08:00\",\"lt\":\"2013-02-24T00:00:00.000-08:00\",\"name\":\"2013-02-17T00:00:00.000-08:00\",\"label\":\"2013-07\"},{\"ge\":\"2013-02-24T00:00:00.000-08:00\",\"lt\":\"2013-03-03T00:00:00.000-08:00\",\"name\":\"2013-02-24T00:00:00.000-08:00\",\"label\":\"2013-08\"},{\"ge\":\"2013-03-03T00:00:00.000-08:00\",\"lt\":\"2013-03-10T00:00:00.000-08:00\",\"name\":\"2013-03-03T00:00:00.000-08:00\",\"label\":\"2013-09\"},{\"ge\":\"2013-03-10T00:00:00.000-08:00\",\"lt\":\"2013-03-17T00:00:00.000-07:00\",\"name\":\"2013-03-10T00:00:00.000-08:00\",\"label\":\"2013-10\"},{\"ge\":\"2013-03-17T00:00:00.000-07:00\",\"lt\":\"2013-03-24T00:00:00.000-07:00\",\"name\":\"2013-03-17T00:00:00.000-07:00\",\"label\":\"2013-11\"},{\"ge\":\"2013-03-24T00:00:00.000-07:00\",\"lt\":\"2013-03-31T00:00:00.000-07:00\",\"name\":\"2013-03-24T00:00:00.000-07:00\",\"label\":\"2013-12\"},{\"ge\":\"2013-03-31T00:00:00.000-07:00\",\"lt\":\"2013-04-07T00:00:00.000-07:00\",\"name\":\"2013-03-31T00:00:00.000-07:00\",\"label\":\"2013-13\"},{\"ge\":\"2013-04-07T00:00:00.000-07:00\",\"lt\":\"2013-04-14T00:00:00.000-07:00\",\"name\":\"2013-04-07T00:00:00.000-07:00\",\"label\":\"2013-14\"},{\"ge\":\"2013-04-14T00:00:00.000-07:00\",\"lt\":\"2013-04-21T00:00:00.000-07:00\",\"name\":\"2013-04-14T00:00:00.000-07:00\",\"label\":\"2013-15\"},{\"ge\":\"2013-04-21T00:00:00.000-07:00\",\"lt\":\"2013-04-28T00:00:00.000-07:00\",\"name\":\"2013-04-21T00:00:00.000-07:00\",\"label\":\"2013-16\"},{\"ge\":\"2013-04-28T00:00:00.000-07:00\",\"lt\":\"2013-05-05T00:00:00.000-07:00\",\"name\":\"2013-04-28T00:00:00.000-07:00\",\"label\":\"2013-17\"},{\"ge\":\"2013-05-05T00:00:00.000-07:00\",\"lt\":\"2013-05-12T00:00:00.000-07:00\",\"name\":\"2013-05-05T00:00:00.000-07:00\",\"label\":\"2013-18\"},{\"ge\":\"2013-05-12T00:00:00.000-07:00\",\"lt\":\"2013-05-19T00:00:00.000-07:00\",\"name\":\"2013-05-12T00:00:00.000-07:00\",\"label\":\"2013-19\"},{\"ge\":\"2013-05-19T00:00:00.000-07:00\",\"lt\":\"2013-05-26T00:00:00.000-07:00\",\"name\":\"2013-05-19T00:00:00.000-07:00\",\"label\":\"2013-20\"},{\"ge\":\"2013-05-26T00:00:00.000-07:00\",\"lt\":\"2013-06-02T00:00:00.000-07:00\",\"name\":\"2013-05-26T00:00:00.000-07:00\",\"label\":\"2013-21\"}]},\"name\":\"date\"}}";
		JSONAssert.assertEquals(actual, expected, false);	
	}
	
	@Test
	public void testMonthBuilder() throws JsonProcessingException, JSONException {
		ObjectMapper mapper = new CustomObjectMapper();
		DateTime minDate = new DateTime(2013, 1, 31, 0, 0);
		DateTime maxDate =minDate.plusMonths(40);
		
		String actual = mapper.writeValueAsString(
				DateFacetBuilder.dateFacet(minDate, maxDate));

		String expected = "{\"constraint\":{\"range\":{\"type\":\"xs:dateTime\",\"facet\":true,\"json-property\":\"lastActivityDate\",\"bucket\":[{\"ge\":\"2012-12-31T00:00:00.000-08:00\",\"lt\":\"2013-01-31T00:00:00.000-08:00\",\"name\":\"2012-12-31T00:00:00.000-08:00\",\"label\":\"2012-12\"},{\"ge\":\"2013-01-31T00:00:00.000-08:00\",\"lt\":\"2013-02-28T00:00:00.000-08:00\",\"name\":\"2013-01-31T00:00:00.000-08:00\",\"label\":\"2013-01\"},{\"ge\":\"2013-02-28T00:00:00.000-08:00\",\"lt\":\"2013-03-28T00:00:00.000-07:00\",\"name\":\"2013-02-28T00:00:00.000-08:00\",\"label\":\"2013-02\"},{\"ge\":\"2013-03-28T00:00:00.000-07:00\",\"lt\":\"2013-04-28T00:00:00.000-07:00\",\"name\":\"2013-03-28T00:00:00.000-07:00\",\"label\":\"2013-03\"},{\"ge\":\"2013-04-28T00:00:00.000-07:00\",\"lt\":\"2013-05-28T00:00:00.000-07:00\",\"name\":\"2013-04-28T00:00:00.000-07:00\",\"label\":\"2013-04\"},{\"ge\":\"2013-05-28T00:00:00.000-07:00\",\"lt\":\"2013-06-28T00:00:00.000-07:00\",\"name\":\"2013-05-28T00:00:00.000-07:00\",\"label\":\"2013-05\"},{\"ge\":\"2013-06-28T00:00:00.000-07:00\",\"lt\":\"2013-07-28T00:00:00.000-07:00\",\"name\":\"2013-06-28T00:00:00.000-07:00\",\"label\":\"2013-06\"},{\"ge\":\"2013-07-28T00:00:00.000-07:00\",\"lt\":\"2013-08-28T00:00:00.000-07:00\",\"name\":\"2013-07-28T00:00:00.000-07:00\",\"label\":\"2013-07\"},{\"ge\":\"2013-08-28T00:00:00.000-07:00\",\"lt\":\"2013-09-28T00:00:00.000-07:00\",\"name\":\"2013-08-28T00:00:00.000-07:00\",\"label\":\"2013-08\"},{\"ge\":\"2013-09-28T00:00:00.000-07:00\",\"lt\":\"2013-10-28T00:00:00.000-07:00\",\"name\":\"2013-09-28T00:00:00.000-07:00\",\"label\":\"2013-09\"},{\"ge\":\"2013-10-28T00:00:00.000-07:00\",\"lt\":\"2013-11-28T00:00:00.000-08:00\",\"name\":\"2013-10-28T00:00:00.000-07:00\",\"label\":\"2013-10\"},{\"ge\":\"2013-11-28T00:00:00.000-08:00\",\"lt\":\"2013-12-28T00:00:00.000-08:00\",\"name\":\"2013-11-28T00:00:00.000-08:00\",\"label\":\"2013-11\"},{\"ge\":\"2013-12-28T00:00:00.000-08:00\",\"lt\":\"2014-01-28T00:00:00.000-08:00\",\"name\":\"2013-12-28T00:00:00.000-08:00\",\"label\":\"2013-12\"},{\"ge\":\"2014-01-28T00:00:00.000-08:00\",\"lt\":\"2014-02-28T00:00:00.000-08:00\",\"name\":\"2014-01-28T00:00:00.000-08:00\",\"label\":\"2014-01\"},{\"ge\":\"2014-02-28T00:00:00.000-08:00\",\"lt\":\"2014-03-28T00:00:00.000-07:00\",\"name\":\"2014-02-28T00:00:00.000-08:00\",\"label\":\"2014-02\"},{\"ge\":\"2014-03-28T00:00:00.000-07:00\",\"lt\":\"2014-04-28T00:00:00.000-07:00\",\"name\":\"2014-03-28T00:00:00.000-07:00\",\"label\":\"2014-03\"},{\"ge\":\"2014-04-28T00:00:00.000-07:00\",\"lt\":\"2014-05-28T00:00:00.000-07:00\",\"name\":\"2014-04-28T00:00:00.000-07:00\",\"label\":\"2014-04\"},{\"ge\":\"2014-05-28T00:00:00.000-07:00\",\"lt\":\"2014-06-28T00:00:00.000-07:00\",\"name\":\"2014-05-28T00:00:00.000-07:00\",\"label\":\"2014-05\"},{\"ge\":\"2014-06-28T00:00:00.000-07:00\",\"lt\":\"2014-07-28T00:00:00.000-07:00\",\"name\":\"2014-06-28T00:00:00.000-07:00\",\"label\":\"2014-06\"},{\"ge\":\"2014-07-28T00:00:00.000-07:00\",\"lt\":\"2014-08-28T00:00:00.000-07:00\",\"name\":\"2014-07-28T00:00:00.000-07:00\",\"label\":\"2014-07\"},{\"ge\":\"2014-08-28T00:00:00.000-07:00\",\"lt\":\"2014-09-28T00:00:00.000-07:00\",\"name\":\"2014-08-28T00:00:00.000-07:00\",\"label\":\"2014-08\"},{\"ge\":\"2014-09-28T00:00:00.000-07:00\",\"lt\":\"2014-10-28T00:00:00.000-07:00\",\"name\":\"2014-09-28T00:00:00.000-07:00\",\"label\":\"2014-09\"},{\"ge\":\"2014-10-28T00:00:00.000-07:00\",\"lt\":\"2014-11-28T00:00:00.000-08:00\",\"name\":\"2014-10-28T00:00:00.000-07:00\",\"label\":\"2014-10\"},{\"ge\":\"2014-11-28T00:00:00.000-08:00\",\"lt\":\"2014-12-28T00:00:00.000-08:00\",\"name\":\"2014-11-28T00:00:00.000-08:00\",\"label\":\"2014-11\"},{\"ge\":\"2014-12-28T00:00:00.000-08:00\",\"lt\":\"2015-01-28T00:00:00.000-08:00\",\"name\":\"2014-12-28T00:00:00.000-08:00\",\"label\":\"2014-12\"},{\"ge\":\"2015-01-28T00:00:00.000-08:00\",\"lt\":\"2015-02-28T00:00:00.000-08:00\",\"name\":\"2015-01-28T00:00:00.000-08:00\",\"label\":\"2015-01\"},{\"ge\":\"2015-02-28T00:00:00.000-08:00\",\"lt\":\"2015-03-28T00:00:00.000-07:00\",\"name\":\"2015-02-28T00:00:00.000-08:00\",\"label\":\"2015-02\"},{\"ge\":\"2015-03-28T00:00:00.000-07:00\",\"lt\":\"2015-04-28T00:00:00.000-07:00\",\"name\":\"2015-03-28T00:00:00.000-07:00\",\"label\":\"2015-03\"},{\"ge\":\"2015-04-28T00:00:00.000-07:00\",\"lt\":\"2015-05-28T00:00:00.000-07:00\",\"name\":\"2015-04-28T00:00:00.000-07:00\",\"label\":\"2015-04\"},{\"ge\":\"2015-05-28T00:00:00.000-07:00\",\"lt\":\"2015-06-28T00:00:00.000-07:00\",\"name\":\"2015-05-28T00:00:00.000-07:00\",\"label\":\"2015-05\"},{\"ge\":\"2015-06-28T00:00:00.000-07:00\",\"lt\":\"2015-07-28T00:00:00.000-07:00\",\"name\":\"2015-06-28T00:00:00.000-07:00\",\"label\":\"2015-06\"},{\"ge\":\"2015-07-28T00:00:00.000-07:00\",\"lt\":\"2015-08-28T00:00:00.000-07:00\",\"name\":\"2015-07-28T00:00:00.000-07:00\",\"label\":\"2015-07\"},{\"ge\":\"2015-08-28T00:00:00.000-07:00\",\"lt\":\"2015-09-28T00:00:00.000-07:00\",\"name\":\"2015-08-28T00:00:00.000-07:00\",\"label\":\"2015-08\"},{\"ge\":\"2015-09-28T00:00:00.000-07:00\",\"lt\":\"2015-10-28T00:00:00.000-07:00\",\"name\":\"2015-09-28T00:00:00.000-07:00\",\"label\":\"2015-09\"},{\"ge\":\"2015-10-28T00:00:00.000-07:00\",\"lt\":\"2015-11-28T00:00:00.000-08:00\",\"name\":\"2015-10-28T00:00:00.000-07:00\",\"label\":\"2015-10\"},{\"ge\":\"2015-11-28T00:00:00.000-08:00\",\"lt\":\"2015-12-28T00:00:00.000-08:00\",\"name\":\"2015-11-28T00:00:00.000-08:00\",\"label\":\"2015-11\"},{\"ge\":\"2015-12-28T00:00:00.000-08:00\",\"lt\":\"2016-01-28T00:00:00.000-08:00\",\"name\":\"2015-12-28T00:00:00.000-08:00\",\"label\":\"2015-12\"},{\"ge\":\"2016-01-28T00:00:00.000-08:00\",\"lt\":\"2016-02-28T00:00:00.000-08:00\",\"name\":\"2016-01-28T00:00:00.000-08:00\",\"label\":\"2016-01\"},{\"ge\":\"2016-02-28T00:00:00.000-08:00\",\"lt\":\"2016-03-28T00:00:00.000-07:00\",\"name\":\"2016-02-28T00:00:00.000-08:00\",\"label\":\"2016-02\"},{\"ge\":\"2016-03-28T00:00:00.000-07:00\",\"lt\":\"2016-04-28T00:00:00.000-07:00\",\"name\":\"2016-03-28T00:00:00.000-07:00\",\"label\":\"2016-03\"},{\"ge\":\"2016-04-28T00:00:00.000-07:00\",\"lt\":\"2016-05-28T00:00:00.000-07:00\",\"name\":\"2016-04-28T00:00:00.000-07:00\",\"label\":\"2016-04\"},{\"ge\":\"2016-05-28T00:00:00.000-07:00\",\"lt\":\"2016-06-28T00:00:00.000-07:00\",\"name\":\"2016-05-28T00:00:00.000-07:00\",\"label\":\"2016-05\"}]},\"name\":\"date\"}}";
		JSONAssert.assertEquals(actual, expected, false);	
	}
	
	@Test
	public void testDecorateStructuredQuery() {
		
	}
}
