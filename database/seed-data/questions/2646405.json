{
  "id": "/questions/2646405",
  "creationDate": "2014-04-17T22:56:38.790",
  "body": "\n\nWe have a Spring application that uses Apache DBCP for connection pooling.  Our app has been in production for almost a year with no problems.  However, during the past few weeks, the application has frozen a number of times.  (By frozen, I mean no requests are handled.)  The problem is temporarily fixed by restarting the Glassfish domain that hosts the app.\n\nWe are monitoring the memory (heap + nonheap) and CPU utilization of this application.  Nothing seems out of the ordinary here.  We have noticed however, that when we restart the domain, we get exception messages similar to the one at the bottom of this post in our log files.\n\nI point out that we are using DBCP, because each of this NPEs reports the borrowObject method at the top of the stack.  Each of them occurs within the same millisecond during any application shutdown.\n\nWe have noticed that there are a couple of these happening in the past (a shutdown with such an NPE), but when the application freezes, there are always five.  This, we don't believe to be coincidental, is the same number of HTTPSSLWorkerThreads handling requests to the application.\n\nIf anyone knows what is causing this, and how to fix it, help would be greatly appreciated.\n\n\t[#|2009-09-27T12:17:12.209-0400|SEVERE|sun-appserver9.1|javax.enterprise.system.container.web|_ThreadID=20;_ThreadName=httpSSLWorkerThread-443-4;_RequestID=25b115cb-de08-4ad4-bfdb-f76eb13b4bbe;|StandardWrapperValve[spring-dispatcher]: PWC1406: Servlet.service() for servlet spring-dispatcher threw exception\n\tjava.lang.NullPointerException\n\t  at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:788)\n\t  at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:95)\n\t  at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:540)\n\t  at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:113)\n\t  at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:79)\n\t  at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:552)\n\t  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:616)\n\t  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:645)\n\t  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:653)\n\t  at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:685)\n\t  at org.springframework.jdbc.core.simple.SimpleJdbcTemplate.query(SimpleJdbcTemplate.java:187)\n\t  at stimpl.dao.ProjectDAO.getSearchResults(ProjectDAO.java:153)\n\t  at stimpl.service.StimPlService.getSearchResults(StimPlService.java:69)\n\t  at stimpl.mvc.search.ShowResultsController.handleRequestInternal(ShowResultsController.java:44)\n\t  at org.springframework.web.servlet.mvc.AbstractController.handleRequest(AbstractController.java:153)\n\t  at org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter.handle(SimpleControllerHandlerAdapter.java:48)\n\t  at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:874)\n\t  at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:808)\n\t  at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:476)\n\t  at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:431)\n\t  at javax.servlet.http.HttpServlet.service(HttpServlet.java:718)\n\t  at javax.servlet.http.HttpServlet.service(HttpServlet.java:831)\n\t  at org.apache.catalina.core.ApplicationFilterChain.servletService(ApplicationFilterChain.java:411)\n\t  at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:317)\n\t  at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:198)\n\t  at org.acegisecurity.securechannel.ChannelProcessingFilter.doFilter(ChannelProcessingFilter.java:138)\n\t  at org.acegisecurity.util.FilterToBeanProxy.doFilter(FilterToBeanProxy.java:98)\n\t  at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n\t  at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:198)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:265)\n\t  at org.acegisecurity.intercept.web.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:107)\n\t  at org.acegisecurity.intercept.web.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:72)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:275)\n\t  at org.acegisecurity.ui.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:124)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:275)\n\t  at org.acegisecurity.providers.anonymous.AnonymousProcessingFilter.doFilter(AnonymousProcessingFilter.java:125)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:275)\n\t  at org.acegisecurity.wrapper.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:81)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:275)\n\t  at org.acegisecurity.ui.AbstractProcessingFilter.doFilter(AbstractProcessingFilter.java:271)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:275)\n\t  at org.acegisecurity.ui.logout.LogoutFilter.doFilter(LogoutFilter.java:110)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:275)\n\t  at org.acegisecurity.context.HttpSessionContextIntegrationFilter.doFilter(HttpSessionContextIntegrationFilter.java:249)\n\t  at org.acegisecurity.util.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:275)\n\t  at org.acegisecurity.util.FilterChainProxy.doFilter(FilterChainProxy.java:149)\n\t  at org.acegisecurity.util.FilterToBeanProxy.doFilter(FilterToBeanProxy.java:98)\n\t  at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:230)\n\t  at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:198)\n\t  at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:288)\n\t  at org.apache.catalina.core.StandardContextValve.invokeInternal(StandardContextValve.java:271)\n\t  at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:202)\n\t  at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n\t  at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n\t  at com.sun.enterprise.web.WebPipeline.invoke(WebPipeline.java:94)\n\t  at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:206)\n\t  at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n\t  at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n\t  at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:571)\n\t  at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1080)\n\t  at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:150)\n\t  at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:632)\n\t  at org.apache.catalina.core.StandardPipeline.doInvoke(StandardPipeline.java:577)\n\t  at org.apache.catalina.core.StandardPipeline.invoke(StandardPipeline.java:571)\n\t  at org.apache.catalina.core.ContainerBase.invoke(ContainerBase.java:1080)\n\t  at org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:270)\n\t  at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.invokeAdapter(DefaultProcessorTask.java:637)\n\t  at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.doProcess(DefaultProcessorTask.java:568)\n\t  at com.sun.enterprise.web.connector.grizzly.DefaultProcessorTask.process(DefaultProcessorTask.java:813)\n\t  at com.sun.enterprise.web.connector.grizzly.DefaultReadTask.executeProcessorTask(DefaultReadTask.java:339)\n\t  at com.sun.enterprise.web.connector.grizzly.ssl.SSLReadTask.process(SSLReadTask.java:440)\n\t  at com.sun.enterprise.web.connector.grizzly.ssl.SSLReadTask.doTask(SSLReadTask.java:228)\n\t  at com.sun.enterprise.web.connector.grizzly.TaskBase.run(TaskBase.java:265)\n\t  at com.sun.enterprise.web.connector.grizzly.ssl.SSLWorkerThread.run(SSLWorkerThread.java:106)\n\t|#]\n\t",
  "lastActivityDate": "2014-03-31T00:16:18.700",
  "title": "Connection Pool hangs using Glassfish and Apache DBCP with Spring",
  "tags": [
    "spring",
    "glassfish",
    "apache-commons-dbcp"
  ],
  "docScore": 0,
  "comments": [],
  "answers": [],
  "creationYearMonth": "201403",
  "itemTally": 0,
  "owner": null
}